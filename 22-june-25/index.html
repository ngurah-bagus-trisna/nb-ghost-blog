<!DOCTYPE html>
<html lang="id">
<head>

    <title>22-June-25</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="preload" as="style" href="/assets/built/screen.css?v=a90396e918">
    <link rel="preload" as="script" href="/assets/built/source.js?v=a90396e918">
    
    <link rel="preload" as="font" type="font/woff2" href="/assets/fonts/inter-roman.woff2?v=a90396e918" crossorigin="anonymous">
<style>
    @font-face {
        font-family: "Inter";
        font-style: normal;
        font-weight: 100 900;
        font-display: optional;
        src: url(/assets/fonts/inter-roman.woff2?v=a90396e918) format("woff2");
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
</style>

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=a90396e918">

    <style>
        :root {
            --background-color: #151515
        }
    </style>

    <script>
        /* The script for calculating the color contrast has been taken from
        https://gomakethings.com/dynamically-changing-the-text-color-based-on-background-color-contrast-with-vanilla-js/ */
        var accentColor = getComputedStyle(document.documentElement).getPropertyValue('--background-color');
        accentColor = accentColor.trim().slice(1);

        if (accentColor.length === 3) {
            accentColor = accentColor[0] + accentColor[0] + accentColor[1] + accentColor[1] + accentColor[2] + accentColor[2];
        }

        var r = parseInt(accentColor.substr(0, 2), 16);
        var g = parseInt(accentColor.substr(2, 2), 16);
        var b = parseInt(accentColor.substr(4, 2), 16);
        var yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
        var textColor = (yiq >= 128) ? 'dark' : 'light';

        document.documentElement.className = `has-${textColor}-text`;
    </script>

    <meta name="description" content="Learn IAM Roles, EC2 Instance Profile &amp; Provisioning VPC using Iaac (Terraform)">
    <link rel="icon" href="https://twnb.nbtrisna.my.id/content/images/size/w256h256/2023/12/Logo-CHannel-1.png" type="image/png">
    <link rel="canonical" href="https://twnb.nbtrisna.my.id/22-june-25/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="twnb">
    <meta property="og:type" content="article">
    <meta property="og:title" content="22-June-25">
    <meta property="og:description" content="Learn IAM Roles, EC2 Instance Profile &amp; Provisioning VPC using Iaac (Terraform)">
    <meta property="og:url" content="https://twnb.nbtrisna.my.id/22-june-25/">
    <meta property="og:image" content="https://photoby.nbtrisna.my.id/1e929f06-0136-4b70-8924-cd9e66ff281b.jpg">
    <meta property="article:published_time" content="2025-06-22T13:08:10.000Z">
    <meta property="article:modified_time" content="2025-06-23T00:23:58.000Z">
    <meta property="article:tag" content="daily-notes">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="22-June-25">
    <meta name="twitter:description" content="Learn IAM Roles, EC2 Instance Profile &amp; Provisioning VPC using Iaac (Terraform)">
    <meta name="twitter:url" content="https://twnb.nbtrisna.my.id/22-june-25/">
    <meta name="twitter:image" content="https://photoby.nbtrisna.my.id/1e929f06-0136-4b70-8924-cd9e66ff281b.jpg">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="I Gusti Ngurah Bagus Trisna Andika">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="daily-notes">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="800">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "twnb",
        "url": "https://twnb.nbtrisna.my.id/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://twnb.nbtrisna.my.id/content/images/2024/08/logo-Primary-1.png",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "I Gusti Ngurah Bagus Trisna Andika",
        "image": {
            "@type": "ImageObject",
            "url": "https://www.gravatar.com/avatar/67669d72ccc65017961ab1d385f74c60?s=250&r=x&d=mp"
        },
        "url": "https://twnb.nbtrisna.my.id/author/ngurah/",
        "sameAs": []
    },
    "headline": "22-June-25",
    "url": "https://twnb.nbtrisna.my.id/22-june-25/",
    "datePublished": "2025-06-22T13:08:10.000Z",
    "dateModified": "2025-06-23T00:23:58.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://photoby.nbtrisna.my.id/1e929f06-0136-4b70-8924-cd9e66ff281b.jpg",
        "width": 1200,
        "height": 800
    },
    "keywords": "daily-notes",
    "description": "Learn IAM Roles, EC2 Instance Profile &amp; Provisioning VPC using Iaac (Terraform)",
    "mainEntityOfPage": "https://twnb.nbtrisna.my.id/22-june-25/"
}
    </script>

    <meta name="generator" content="Ghost 5.125">
    <link rel="alternate" type="application/rss+xml" title="twnb" href="https://twnb.nbtrisna.my.id/rss/">
    
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.5/umd/sodo-search.min.js" data-key="d8018a425f7cfc3913d46bfa03" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.5/umd/main.css" data-sodo-search="https://twnb.nbtrisna.my.id/" data-locale="id" crossorigin="anonymous"></script>
    
    <link href="https://twnb.nbtrisna.my.id/webmentions/receive/" rel="webmention">
    <script defer src="/public/cards.min.js?v=a90396e918"></script><style>:root {--ghost-accent-color: #b6bdff;}</style>
    <link rel="stylesheet" type="text/css" href="/public/cards.min.css?v=a90396e918">
    <meta name="google-site-verification" content="aJn625qTdbOQcWo6rLrtjWcfkTE6RlP1zdyLCECipdQ" />
<!-- Dracula Theme for Prism (Unpkg) -->
<link rel="stylesheet" href="https://unpkg.com/dracula-prism/dist/css/dracula-prism.css">

<!-- Line Numbers Plugin CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.css">

<!-- Toolbar & Copy Button CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.css">

<!-- Fira Code Font -->
<link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">

<style>
  /* ── Wrapper & Terminal Chrome ───────────────────────────────────────── */
  .code-block-wrapper {
    position: relative;
    background: #282a36;
    border-radius: 6px;
    margin: 1.5rem 0;
    font-family: 'Fira Code', monospace;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
  }

  /* Title bar */
  .code-block-wrapper .title-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 1.8rem;
    padding: 1.5rem 1rem;
    background: #21222c;
    color: #f8f8f2;
    font-size: 0.85rem;
    font-weight: 500;
    user-select: none;
  }
  
  /* MacOS style dots */
  .code-block-wrapper .title-bar .dots {
    display: flex;
    gap: 6px;
  }
  .code-block-wrapper .title-bar .dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
  }
  .code-block-wrapper .title-bar .dot-red {
    background: #ff5f56;
  }
  .code-block-wrapper .title-bar .dot-yellow {
    background: #ffbd2e;
  }
  .code-block-wrapper .title-bar .dot-green {
    background: #27c93f;
  }

  /* File name styling */
  .code-block-wrapper .file-name {
    color: #bd93f9;
    font-weight: normal;
    margin-left: 0.5rem;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 50%;
  }

  /* Hide default toolbar */
  .code-block-wrapper .code-toolbar > .toolbar {
    display: none !important;
  }

  /* Custom copy button - hidden by default */
  .code-block-wrapper .custom-copy-btn {
    position: absolute;
    top: 3rem;
    right: 0rem;
    background: rgba(40, 42, 54, 0.7);
    border: 1px solid #6272a4;
    border-radius: 3px;
    color: #f8f8f2;
    cursor: pointer;
    font-size: 0.8rem;
    padding: 0.25rem 0.5rem;
    opacity: 0;
    transition: opacity 0.2s;
    z-index: 10;
    font-family: 'Fira Code', monospace;
  }
  
  /* Show copy button on hover */
  .code-block-wrapper:hover .custom-copy-btn {
    opacity: 1;
  }
  
  .code-block-wrapper .custom-copy-btn:hover {
    background: rgba(68, 71, 90, 0.7);
  }

  /* Line numbers adjustments */
  pre.line-numbers {
    margin: 0;
    padding-top: 2.2rem !important;
    padding-bottom: 1rem !important;
  }
  
  /* Dynamic padding for line numbers */
  pre.line-numbers[data-line] {
    padding-left: 3.5rem !important; /* Default for 1-9 lines */
  }
  
  pre.line-numbers[data-line="10"] {
    padding-left: 3.8rem !important; /* 10-99 lines */
  }
  
  pre.line-numbers[data-line="100"] {
    padding-left: 4.2rem !important; /* 100-999 lines */
  }
  
  /* Adjust line numbers position */
  .line-numbers .line-numbers-rows {
    top: 2.2rem !important;
    width: auto !important;
    padding: 0 0.5rem;
    background: rgba(40, 42, 54, 0.5);
  }
  
  /* Adjust code padding */
  pre[class*="language-"] {
    padding-top: 2.2rem !important;
    padding-bottom: 1rem !important;
    padding-right: 1rem !important;
  }
  
  /* Better line number visibility */
  .line-numbers .line-numbers-rows > span:before {
    color: #6272a4 !important;
    padding-right: 1rem;
  }


    /* BEGIN IMAGE POST EDIT */
  .gh-article-image {
    position: relative;
    overflow: hidden;
    border-radius: 6px;
    margin-bottom: 1rem;
  }
  
  /* Gambar */
  .gh-article-image img {
    width: 100%;
    height: auto;
    display: block;
    object-fit: cover;
    object-position: center;
    border-radius: 6px;
  }
  
  /* Figcaption normal di bawah */
  .gh-article-image figcaption {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.7);
    color: #fff;
    font-size: 1rem;
    padding: 0.75rem 1rem;
    font-style: italic;
    line-height: 1.5;
    border-bottom-left-radius: 6px;
    border-bottom-right-radius: 6px;
    backdrop-filter: blur(2px);
    z-index: 1;
  }

</style>
    <link rel="preconnect" href="https://fonts.bunny.net"><link rel="stylesheet" href="https://fonts.bunny.net/css?family=noto-sans:400,700|space-mono:400,700"><style>:root {--gh-font-heading: Noto Sans;--gh-font-body: Space Mono;}</style>

</head>
<body class="post-template tag-daily-notes gh-font-heading-noto-sans gh-font-body-space-mono has-sans-title has-sans-body">

<div class="gh-viewport">
    
    <header id="gh-navigation" class="gh-navigation is-left-logo gh-outer">
    <div class="gh-navigation-inner gh-inner">

        <div class="gh-navigation-brand">
            <a class="gh-navigation-logo is-title" href="https://twnb.nbtrisna.my.id">
                    <img src="https://twnb.nbtrisna.my.id/content/images/2024/08/logo-Primary-1.png" alt="twnb">
            </a>
            <button class="gh-search gh-icon-button" aria-label="Search this site" data-ghost-search>
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>            <button class="gh-burger gh-icon-button" aria-label="Menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128ZM40,72H216a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16ZM216,184H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg>                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path></svg>            </button>
        </div>

        <nav class="gh-navigation-menu">
            <ul class="nav">
    <li class="nav-home"><a href="https://twnb.nbtrisna.my.id/">Home</a></li>
    <li class="nav-daily-notes"><a href="https://twnb.nbtrisna.my.id/tag/daily-notes/">Daily Notes</a></li>
    <li class="nav-blog"><a href="https://twnb.nbtrisna.my.id/tag/catatan/">Blog</a></li>
    <li class="nav-about"><a href="https://twnb.nbtrisna.my.id/about/">About</a></li>
</ul>

        </nav>

        <div class="gh-navigation-actions">
                    <button class="gh-search gh-icon-button" aria-label="Search this site" data-ghost-search>
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>        </div>

    </div>
</header>

    

<main class="gh-main">

    <article class="gh-article post tag-daily-notes">

        <header class="gh-article-header gh-canvas">

                <a class="gh-article-tag" href="https://twnb.nbtrisna.my.id/tag/daily-notes/">daily-notes</a>
            <h1 class="gh-article-title is-title">22-June-25</h1>
                <p class="gh-article-excerpt is-body">Learn IAM Roles, EC2 Instance Profile &amp; Provisioning VPC using Iaac (Terraform)</p>


                <figure class="gh-article-image">
        <img
            srcset="https://photoby.nbtrisna.my.id/1e929f06-0136-4b70-8924-cd9e66ff281b.jpg 320w,
                    https://photoby.nbtrisna.my.id/1e929f06-0136-4b70-8924-cd9e66ff281b.jpg 600w,
                    https://photoby.nbtrisna.my.id/1e929f06-0136-4b70-8924-cd9e66ff281b.jpg 960w,
                    https://photoby.nbtrisna.my.id/1e929f06-0136-4b70-8924-cd9e66ff281b.jpg 1200w,
                    https://photoby.nbtrisna.my.id/1e929f06-0136-4b70-8924-cd9e66ff281b.jpg 2000w"
            sizes="(max-width: 1200px) 100vw, 1120px"
            src="https://photoby.nbtrisna.my.id/1e929f06-0136-4b70-8924-cd9e66ff281b.jpg"
            alt="22-June-25"
        >
            <figcaption><b><strong style="white-space: pre-wrap;">Photo by nbtrisna</strong></b><span style="white-space: pre-wrap;"> Steaming trays and quiet hum, a monochrome glimpse into the daily ritual of sustenance.</span></figcaption>
    </figure>

        </header>

        <section class="gh-content gh-canvas is-body">
            <h2 id="aws-iam-roles-ec2-instance-profiles">AWS IAM Roles &amp; EC2 Instance Profiles</h2><blockquote>Application that run on EC2 Instance must include AWS credentials in AWS API request. You could have developers to uplaod credentials directly to instances, but developer need to check again the credential can securely access AWS API and update each amaszon credential when time will come. It's painfull workflow.</blockquote><p>Instead you can add should use IAM role to manage temporary credentials for application that run on EC2 instance. When use a role, you don't have to distribute long-term credentials (like sign-in credentials or access keys).</p><p>Reference :</p><ul><li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2.html?ref=dev.nbtrisna.my.id">Use IAM role to grant permissiont to application running on EC2 Instances</a></li><li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html?ref=dev.nbtrisna.my.id">Instance Metadata Services</a></li></ul><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622091858.png" class="kg-image" alt="Pasted image 20250622091858" loading="lazy" width="621" height="296"></figure><blockquote><strong>Real world usecase :</strong> A web server running on EC2 needs to fetch secrets on AWS System Manager Parameter Store (SSM) and upload logs to S3 bucket-without embedding long-lived api keys in your AMI</blockquote><p><strong>Skenario</strong> : Design IAM Role <code>WebServerRole</code> that allows only <code>ssm:GetParameter</code>, <code>s3:PutObject</code>.</p><h3 id="create-role-webserverrole-with-policy-allows-ssmgetparameter-s3putobject-to-one-bucket-prefix">Create role <code>WebServerRole</code>, with policy allows <code>ssm:GetParameter</code>, <code>s3:PutObject</code> to one bucket prefix</h3><h4 id="s3-bukcet">S3 Bukcet</h4><blockquote>Amazon S3 is an object storage service that offers industry-leading scalability, data availability, security, and performance</blockquote><p>To create bucket first navigate to <code>S3</code></p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622095240.png" class="kg-image" alt="Pasted image 20250622095240" loading="lazy" width="2040" height="1030"></figure><p>Click <code>Create S3</code></p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622095313.png" class="kg-image" alt="Pasted image 20250622095313" loading="lazy" width="2676" height="632"></figure><p>Begin to setup new bucket</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622095618.png" class="kg-image" alt="Pasted image 20250622095618" loading="lazy" width="3254" height="1834"></figure><blockquote>Bucket name must uniqe becaus after a bucket is created, the name of that bucket cannot be used by another AWS account in any AWS Region until the bucket is deleted</blockquote><p>Leave everything with default configuration, and click <code>Create Bucket</code></p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622095729.png" class="kg-image" alt="Pasted image 20250622095729" loading="lazy" width="3254" height="1834"></figure><p>Bucket created.</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622101907.png" class="kg-image" alt="Pasted image 20250622101907" loading="lazy" width="3266" height="972"></figure><h4 id="role">Role</h4><p>Create an IAM Role <code>WebServerRole</code> that's allows only <code>ssm:GetParameter</code>, <code>s3:PutObject</code>.</p><p>Create policy first, with name <code>GetParameterPutObject</code>. Navigate to <code>Identity and Access Management (IAM) &gt; Policies &gt; Create Policies</code></p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622102313.png" class="kg-image" alt="Pasted image 20250622102313" loading="lazy" width="3262" height="794"></figure><p>We configure policy to allow GetParameter on spesific parameter store path on any region</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622102635.png" class="kg-image" alt="Pasted image 20250622102635" loading="lazy" width="3260" height="1776"></figure><p>Then we add allow <code>S3:PutObject</code> to spesific bucket we created</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622102829.png" class="kg-image" alt="Pasted image 20250622102829" loading="lazy" width="2776" height="1620"></figure><p>Review all, when seems correct, begin to create policy</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622103010.png" class="kg-image" alt="Pasted image 20250622103010" loading="lazy" width="3268" height="1772"></figure><p>Policy created</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622103047.png" class="kg-image" alt="Pasted image 20250622103047" loading="lazy" width="3270" height="872"></figure><p>Then we assign new policy to role <code>WebServerRole</code>. Navigate to <code>Identity and Access Management (IAM) &gt; Roles &gt; Create Role</code></p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622102055.png" class="kg-image" alt="Pasted image 20250622102055" loading="lazy" width="3268" height="1204"></figure><p>Configure trusted entity type to Aws Service, and select EC2. <em>Because this role attached to EC2 Instances</em></p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622103240.png" class="kg-image" alt="Pasted image 20250622103240" loading="lazy" width="3260" height="1260"></figure><p>We need to checklist policy we want to attached to role</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622103338.png" class="kg-image" alt="Pasted image 20250622103338" loading="lazy" width="2748" height="968"></figure><p>Review again, if all corrected, begin to create role</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622103432.png" class="kg-image" alt="Pasted image 20250622103432" loading="lazy" width="2762" height="1670"></figure><p>Role <code>WebServerRole</code> created.</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622104414.png" class="kg-image" alt="Pasted image 20250622104414" loading="lazy" width="3262" height="820"></figure><h4 id="test-launch-instance-and-attach-webserverrole">Test, launch instance and attach <code>WebServerRole</code></h4><p>When provisioning instance, we need to attach <code>WebServerRole</code> in IAM Profile by access to <code>Advanced Details &gt; IAM Instance Profile</code></p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622104706.png" class="kg-image" alt="Pasted image 20250622104706" loading="lazy" width="2036" height="712"></figure><p>Check role attached using IMDSv2</p><pre><code class="language-sh">TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`

curl -H "X-aws-ec2-metadata-token: $TOKEN" \
  http://169.254.169.254/latest/meta-data/iam/security-credentials/
</code></pre><p>Result, successfuly to attach role <code>WebServerRole</code></p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622105547.png" class="kg-image" alt="Pasted image 20250622105547" loading="lazy" width="1420" height="160"></figure><p>Trying to get parameter, <code>nb-test</code></p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622105949.png" class="kg-image" alt="Pasted image 20250622105949" loading="lazy" width="3106" height="640"></figure><pre><code class="language-sh">aws ssm get-parameter
</code></pre><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622110111.png" class="kg-image" alt="Pasted image 20250622110111" loading="lazy" width="1536" height="424"></figure><p>How about <code>delete-parameter</code></p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622110155.png" class="kg-image" alt="Pasted image 20250622110155" loading="lazy" width="3276" height="182"></figure><p>Denied, because doesn't have policy <code>ssm:DeleteParameter</code></p><p>Try to put <code>helo</code> on S3 Bucket</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622110652.png" class="kg-image" alt="Pasted image 20250622110652" loading="lazy" width="1458" height="140"></figure><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622110703.png" class="kg-image" alt="Pasted image 20250622110703" loading="lazy" width="2734" height="772"></figure><h2 id="daily-quest-5-%E2%80%9Cterraforming-the-multi-tier-vpc%E2%80%9D">Daily Quest #5: “Terraforming the Multi-Tier VPC”</h2><blockquote>Terraform is infrastructure as a code tool. Allow user to create anything resources using a declarative code typically HashiCorp Configuration Language (HCL). This can make infrastructure more flexible using code instead of accessing console again-and again.</blockquote><p>Reference :</p><ul><li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs?ref=dev.nbtrisna.my.id">AWS Providers Terraform</a></li><li><a href="https://developer.hashicorp.com/terraform/tutorials/aws-get-started?ref=dev.nbtrisna.my.id">https://developer.hashicorp.com/terraform/tutorials/aws-get-started</a></li><li><a href="https://github.com/ngurah-bagus-trisna/aws-vpc-iaac?ref=dev.nbtrisna.my.id">https://github.com/ngurah-bagus-trisna/aws-vpc-iaac</a></li></ul><p>Infrastructure as Code (IaC) tools allow you to manage infrastructure with configuration files rather than through a graphical user interface. IaC allows you to build, change, and manage your infrastructure in a safe, consistent, and repeatable way by defining resource configurations that you can version, reuse, and share.</p><p>So in this section, i want to create IaaC base from <a href="https://twnb.nbtrisna.my.id/21-june-25/?ref=dev.nbtrisna.my.id">this article</a> section <em>Daily Quest #3: AWS Networking &amp; VPC Deep Dive</em></p><h2 id="setup-opentofu">Setup OpenTofu</h2><blockquote>Opentofu is opensource alternative for terraform.</blockquote><p>Reference :</p><ul><li>https://opentofu.org/docs/intro/install/</li></ul><p>I'm using <em>Ubuntu</em> os so i prefer to chose <code>deb</code> install method</p><pre><code class="language-sh">curl --proto '=https' --tlsv1.2 -fsSL https://get.opentofu.org/install-opentofu.sh -o install-opentofu.sh

chmod +x install-opentofu.sh

./install-opentofu.sh --install-method deb

# verify install
tofu version
</code></pre><p>Result</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622151825.png" class="kg-image" alt="Pasted image 20250622151825" loading="lazy" width="308" height="132"></figure><h3 id="setup-vpc">Setup VPC</h3><ol><li>Create file <code>main.tf</code> with AWS provider and region</li></ol><pre><code class="language-tf file:main.tf">terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~&gt; 5.0"
    }
  }
}

# Configure the AWS Provider
provider "aws" {
  region = "ap-southeast-1"
}
</code></pre><ol start="2"><li>Setup variable.</li></ol><p>On terraform, input variable let you customize aspects of modules without altering the module's own source code. This function allows to share modules accrost different terraform configuration. Create file called <code>variable.tf</code>. <a href="https://opentofu.org/docs/language/values/variables/?ref=dev.nbtrisna.my.id#declaring-an-input-variable">Reference</a></p><pre><code class="language-tf file:variable.tf">variable "vpc_cidr" {
  type = string
}

variable "subnet" {
  type = map(object({
    subnet_range      = string
    availability_zone = string
    type              = string
  }))
}

variable "natgw_name" {
  type = string
}

variable "route_tables" {
  type = map(
    object({
      cidr_source       = string
      route_destination = string
    })
  )
}
</code></pre><p>Then setup <code>main.tf</code></p><pre><code class="language-tf file:main.tf">terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~&gt; 5.0"
    }
  }
}

# Configure the AWS Provider
provider "aws" {
  region = "ap-southeast-1"
}

resource "aws_vpc" "nb-chatgpt-vpc" {
  cidr_block = var.vpc_cidr
  tags = {
    "Name" = "nb-chatgpt-vpc"
  }
}

resource "aws_subnet" "nb-subnet" {
  vpc_id   = aws_vpc.nb-chatgpt-vpc.id
  for_each = var.subnet

  cidr_block        = each.value.subnet_range
  availability_zone = each.value.availability_zone
  tags = {
    "Name" = each.key
    "Type" = each.value.type
  }
}

resource "aws_internet_gateway" "nb-inet-gw" {
  vpc_id = aws_vpc.nb-chatgpt-vpc.id

  tags = {
    Name = "nb-inet-gw"
  }
}

resource "aws_eip" "nb-eip-nat-gw" {
  tags = {
    "Name" = "nb-eip-nat-gw"
  }
}

locals {
  public_subnet_ids = [
    for key, subnet in var.subnet : aws_subnet.nb-subnet[key].id
    if subnet.type == "public"
  ]
  private_subnet_ids = [
    for key, subnet in var.subnet : aws_subnet.nb-subnet[key].id
    if subnet.type == "private"
  ]
}

resource "aws_nat_gateway" "nb-nat-gw" {
  depends_on        = [aws_eip.nb-eip-nat-gw]
  allocation_id     = aws_eip.nb-eip-nat-gw.id
  subnet_id         = local.public_subnet_ids[0]
  connectivity_type = "public"
  tags = {
    "Name" : var.natgw_name
  }
}

resource "aws_route_table" "net-public" {
  for_each = var.route_tables
  vpc_id   = aws_vpc.nb-chatgpt-vpc.id

  route {
    cidr_block     = each.value.cidr_source
    gateway_id     = each.value.route_destination == "igw" ? aws_internet_gateway.nb-inet-gw.id : null
    nat_gateway_id = each.value.route_destination == "nat" ? aws_nat_gateway.nb-nat-gw.id : null
  }
}

resource "aws_route_table_association" "public" {
  subnet_id      = aws_subnet.nb-subnet["public-net"].id
  route_table_id = aws_route_table.net-public["public"].id
}

resource "aws_route_table_association" "private" {
  subnet_id      = aws_subnet.nb-subnet["private-net"].id
  route_table_id = aws_route_table.net-public["private"].id
}

output "vpc_id" {
  value = aws_vpc.nb-chatgpt-vpc.id
}

output "public_subnet_id" {
  value = local.public_subnet_ids
}

output "private_subnet_id" {
  value = local.private_subnet_ids
}

output "nat_gateway_public_ip" {
  value = aws_nat_gateway.nb-nat-gw.public_ip
}
</code></pre><p>Then setup all value for variable in <code>dev.tfvars</code></p><pre><code class="language-tfvars file:dev.tfvars">vpc_cidr = "10.0.0.0/16"
subnet = {
  "public-net" = {
    subnet_range      = "10.0.1.0/24"
    availability_zone = "ap-southeast-1c"
    type              = "public"
  },
  "private-net" = {
    subnet_range      = "10.0.2.0/24"
    availability_zone = "ap-southeast-1c"
    type              = "private"
  }
}

natgw_name = "nb-natgw"

route_tables = {
  "private" = {
    cidr_source       = "0.0.0.0/0"
    route_destination = "nat"
  },
  "public" = {
    cidr_source       = "0.0.0.0/0"
    route_destination = "igw"
  }
}

</code></pre><p>Then Init, plan, apply</p><pre><code class="language-sh">tofu init
tofu plan -var-file=dev.tfvars

# if everything correct, apply to create resources
tofu apply
</code></pre><p>Result</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622193558.png" class="kg-image" alt="Pasted image 20250622193558" loading="lazy" width="504" height="240"></figure><h3 id="testing">Testing</h3><p>Create 2 ec2 instances</p><p><strong>Instance : public-net</strong>, Attach public subnet, and attach elastic-ip for access. Access to instances, check public_ip,</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622194131.png" class="kg-image" alt="Pasted image 20250622194131" loading="lazy" width="2348" height="1482"></figure><p><em>public-net</em> instance using same as <em>public_ipv4</em> attached to instance.</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622194500.png" class="kg-image" alt="Pasted image 20250622194500" loading="lazy" width="1468" height="468"></figure><p>Then access <em>private-net</em> instances from <em>public-net</em>. Makesure public ip using nat gateway address.</p><figure class="kg-card kg-image-card"><img src="https://img.nbtrisna.my.id/Pasted%20image%2020250622194835.png" class="kg-image" alt="Pasted image 20250622194835" loading="lazy" width="1236" height="476"></figure><p>Using nat-gateway address.</p>
        </section>

    </article>


</main>


            <section class="gh-container is-grid gh-outer">
                <div class="gh-container-inner gh-inner">
                    <h2 class="gh-container-title">Read more</h2>
                    <div class="gh-feed">
                            <article class="gh-card post no-image">
    <a class="gh-card-link" href="/21-june-25/">
            <figure class="gh-card-image">
                <img
                    srcset="https://photoby.nbtrisna.my.id/820cd488-1486-482a-932f-08f6e63d1fc1.jpg 160w,
                            https://photoby.nbtrisna.my.id/820cd488-1486-482a-932f-08f6e63d1fc1.jpg 320w,
                            https://photoby.nbtrisna.my.id/820cd488-1486-482a-932f-08f6e63d1fc1.jpg 600w,
                            https://photoby.nbtrisna.my.id/820cd488-1486-482a-932f-08f6e63d1fc1.jpg 960w,
                            https://photoby.nbtrisna.my.id/820cd488-1486-482a-932f-08f6e63d1fc1.jpg 1200w,
                            https://photoby.nbtrisna.my.id/820cd488-1486-482a-932f-08f6e63d1fc1.jpg 2000w"
                    sizes="320px"
                    src="https://photoby.nbtrisna.my.id/820cd488-1486-482a-932f-08f6e63d1fc1.jpg"
                    alt="21-June-25"
                    loading="lazy"
                >
            </figure>
        <div class="gh-card-wrapper">
            <h3 class="gh-card-title is-title">21-June-25</h3>
                <p class="gh-card-excerpt is-body">Learn IAM Policies &amp; AWS Networking</p>
            <footer class="gh-card-meta">
<!--
             -->
                    <span class="gh-card-author">By I Gusti Ngurah Bagus Trisna Andika</span>
                    <time class="gh-card-date" datetime="2025-06-21">21 Jun 2025</time>
                <!--
         --></footer>
        </div>
    </a>
</article>
                            <article class="gh-card post no-image">
    <a class="gh-card-link" href="/20-june-25/">
            <figure class="gh-card-image">
                <img
                    srcset="https://photoby.nbtrisna.my.id/967d5953-56e2-4a9f-b472-444faa0076cd.jpg 160w,
                            https://photoby.nbtrisna.my.id/967d5953-56e2-4a9f-b472-444faa0076cd.jpg 320w,
                            https://photoby.nbtrisna.my.id/967d5953-56e2-4a9f-b472-444faa0076cd.jpg 600w,
                            https://photoby.nbtrisna.my.id/967d5953-56e2-4a9f-b472-444faa0076cd.jpg 960w,
                            https://photoby.nbtrisna.my.id/967d5953-56e2-4a9f-b472-444faa0076cd.jpg 1200w,
                            https://photoby.nbtrisna.my.id/967d5953-56e2-4a9f-b472-444faa0076cd.jpg 2000w"
                    sizes="320px"
                    src="https://photoby.nbtrisna.my.id/967d5953-56e2-4a9f-b472-444faa0076cd.jpg"
                    alt="20-June-25"
                    loading="lazy"
                >
            </figure>
        <div class="gh-card-wrapper">
            <h3 class="gh-card-title is-title">20-June-25</h3>
                <p class="gh-card-excerpt is-body">Learn about basic VPC, subnet, IGW (Internet Gateway), SG (Security Group), and EC2 using AWS Free Tier.</p>
            <footer class="gh-card-meta">
<!--
             -->
                    <span class="gh-card-author">By I Gusti Ngurah Bagus Trisna Andika</span>
                    <time class="gh-card-date" datetime="2025-06-20">20 Jun 2025</time>
                <!--
         --></footer>
        </div>
    </a>
</article>
                            <article class="gh-card post no-image">
    <a class="gh-card-link" href="/19-june-25/">
            <figure class="gh-card-image">
                <img
                    srcset="https://photoby.nbtrisna.my.id/3a4489b7-1846-4855-8306-8a885e6ac289.jpg 160w,
                            https://photoby.nbtrisna.my.id/3a4489b7-1846-4855-8306-8a885e6ac289.jpg 320w,
                            https://photoby.nbtrisna.my.id/3a4489b7-1846-4855-8306-8a885e6ac289.jpg 600w,
                            https://photoby.nbtrisna.my.id/3a4489b7-1846-4855-8306-8a885e6ac289.jpg 960w,
                            https://photoby.nbtrisna.my.id/3a4489b7-1846-4855-8306-8a885e6ac289.jpg 1200w,
                            https://photoby.nbtrisna.my.id/3a4489b7-1846-4855-8306-8a885e6ac289.jpg 2000w"
                    sizes="320px"
                    src="https://photoby.nbtrisna.my.id/3a4489b7-1846-4855-8306-8a885e6ac289.jpg"
                    alt="19-June-25"
                    loading="lazy"
                >
            </figure>
        <div class="gh-card-wrapper">
            <h3 class="gh-card-title is-title">19-June-25</h3>
                <p class="gh-card-excerpt is-body">Create pipeline with lint &amp; unit test, terraform, iaac testing (using terratest), Docker Build &amp; Security Scan (Trivy), Deploy, Smoke Test &amp; Metrics Scrape, Cleanup &amp; Notification</p>
            <footer class="gh-card-meta">
<!--
             -->
                    <span class="gh-card-author">By I Gusti Ngurah Bagus Trisna Andika</span>
                    <time class="gh-card-date" datetime="2025-06-19">19 Jun 2025</time>
                <!--
         --></footer>
        </div>
    </a>
</article>
                            <article class="gh-card post no-image">
    <a class="gh-card-link" href="/18-june-25/">
            <figure class="gh-card-image">
                <img
                    srcset="https://photoby.nbtrisna.my.id/e7be8378-6c86-473e-b6fd-b78721e50f15.jpg 160w,
                            https://photoby.nbtrisna.my.id/e7be8378-6c86-473e-b6fd-b78721e50f15.jpg 320w,
                            https://photoby.nbtrisna.my.id/e7be8378-6c86-473e-b6fd-b78721e50f15.jpg 600w,
                            https://photoby.nbtrisna.my.id/e7be8378-6c86-473e-b6fd-b78721e50f15.jpg 960w,
                            https://photoby.nbtrisna.my.id/e7be8378-6c86-473e-b6fd-b78721e50f15.jpg 1200w,
                            https://photoby.nbtrisna.my.id/e7be8378-6c86-473e-b6fd-b78721e50f15.jpg 2000w"
                    sizes="320px"
                    src="https://photoby.nbtrisna.my.id/e7be8378-6c86-473e-b6fd-b78721e50f15.jpg"
                    alt="18-June-25"
                    loading="lazy"
                >
            </figure>
        <div class="gh-card-wrapper">
            <h3 class="gh-card-title is-title">18-June-25</h3>
                <p class="gh-card-excerpt is-body">Performance optimization in ci/cd pipeline focus on faster build &amp; test for example using feature like caching, and pararel jobs</p>
            <footer class="gh-card-meta">
<!--
             -->
                    <span class="gh-card-author">By I Gusti Ngurah Bagus Trisna Andika</span>
                    <time class="gh-card-date" datetime="2025-06-18">18 Jun 2025</time>
                <!--
         --></footer>
        </div>
    </a>
</article>
                    </div>
                </div>
            </section>

    
    <footer class="gh-footer gh-outer">
    <div class="gh-footer-inner gh-inner">

        <div class="gh-footer-bar">
            <span class="gh-footer-logo is-title">
                    <img src="https://twnb.nbtrisna.my.id/content/images/2024/08/logo-Primary-1.png" alt="twnb">
            </span>
            <nav class="gh-footer-menu">
                
            </nav>
            <div class="gh-footer-copyright">
                Powered by <a href="https://ghost.org/" target="_blank" rel="noopener">Ghost</a>
            </div>
        </div>


    </div>
</footer>    
</div>

    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="pswp__bg"></div>

    <div class="pswp__scroll-wrap">
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
<script src="/assets/built/source.js?v=a90396e918"></script>

<!-- Prism Core & Components -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-yaml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-bash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-typescript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-docker.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll("pre").forEach(pre => {
    const code = pre.querySelector("code");
    if (!code) return;

    // 1) Ensure line-numbers
    pre.classList.add("line-numbers");

    // 2) Wrap with terminal chrome
    const wrapper = document.createElement("div");
    wrapper.className = "code-block-wrapper";
    pre.parentNode.insertBefore(wrapper, pre);
    wrapper.appendChild(pre);

    // 3) Extract file name from class
    let fileName = null;
    const fileNameMatch = code.className.match(/file:([^\s]+)/);
    if (fileNameMatch) {
      fileName = fileNameMatch[1];
      // Remove file class to prevent conflicts
      code.className = code.className.replace(fileNameMatch[0], "");
    }

    // 4) Get language
    const langMatch = code.className.match(/language-([a-zA-Z0-9]+)/);
    const lang = langMatch ? langMatch[1].toUpperCase() : "CODE";
    
    // Create custom copy button
    const copyBtn = document.createElement("button");
    copyBtn.className = "custom-copy-btn";
    copyBtn.textContent = "Copy";
    copyBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      navigator.clipboard.writeText(code.textContent);
      const originalText = copyBtn.textContent;
      copyBtn.textContent = "Copied!";
      setTimeout(() => {
        copyBtn.textContent = originalText;
      }, 2000);
    });

    // Create title bar with MacOS style dots
    const bar = document.createElement("div");
    bar.className = "title-bar";
    
    // Add file name if exists
    let titleContent = `
      <div class="dots">
        <span class="dot dot-red"></span>
        <span class="dot dot-yellow"></span>
        <span class="dot dot-green"></span>
      </div>
      <span class="name">${lang}</span>
    `;
    
    if (fileName) {
      titleContent += `<span class="file-name">${fileName}</span>`;
    }
    
    bar.innerHTML = titleContent;
    
    wrapper.insertBefore(bar, pre);
    wrapper.appendChild(copyBtn);
    
    // Add data-line attribute for dynamic padding
    const lineCount = pre.textContent.split('\n').length;
    pre.setAttribute('data-line', lineCount);
  });

  Prism.highlightAll();
  
  // Adjust line numbers after highlighting
  setTimeout(() => {
    document.querySelectorAll('pre.line-numbers').forEach(pre => {
      const lineNumbers = pre.querySelector('.line-numbers-rows');
      if (lineNumbers) {
        // Set dynamic width based on line count
        const lines = pre.textContent.split('\n').length;
        const digits = Math.floor(Math.log10(lines)) + 1;
        lineNumbers.style.width = `${digits * 0.8 + 2}em`;
      }
    });
  }, 100);
});

document.addEventListener('DOMContentLoaded', function() {
  const footer = document.querySelector('.gh-footer-copyright');
  if (footer) {
    footer.textContent = '© 2025 TWNB. All rights reserved.';
  }
});
</script>

</body>
</html>
